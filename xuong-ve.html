<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X∆∞·ªüng V·∫Ω Di·ªáu K·ª≥</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="style.css">
    <style>
        .drawing-workspace { display: flex; justify-content: center; align-items: flex-start; gap: 30px; margin-top: 30px; flex-wrap: wrap; }
        .toolbar { width: 200px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .toolbar h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .color-palette { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .color-box { width: 45px; height: 45px; border-radius: 50%; cursor: pointer; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.2s, border-color 0.2s; }
        .color-box:hover { transform: scale(1.1); }
        .color-box.selected { border-color: #ff6347; transform: scale(1.1); }
        .canvas-container { text-align: center; }
        .canvas { width: 600px; height: 500px; background: white; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; }
        .canvas svg { width: 90%; height: 90%; display: none; }
        .canvas svg.active { display: block; }
        .canvas .colorable { cursor: pointer; transition: fill 0.2s; }
        .thumbnail-gallery { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .thumbnail { width: 80px; height: 80px; border: 3px solid #ccc; border-radius: 10px; cursor: pointer; padding: 5px; background-color: white; }
        .thumbnail.selected { border-color: #ff6347; }
        .thumbnail svg { width: 100%; height: 100%; pointer-events: none; }
        .score-display { font-size: 1.5rem; font-weight: bold; }
    </style>
</head>
<body class="creative-city-bg">
    <div id="personalized-greeting" class="personalized-greeting" style="position: absolute; top: 10px; left: 10px; font-size: 1rem; font-weight: bold;"></div>
    <h1 class="page-header header-creative">üé® X∆∞·ªüng V·∫Ω Di·ªáu K·ª≥ üé®</h1>
    <div class="drawing-workspace">
        <div class="toolbar">
            <h3>B·∫£ng M√†u</h3>
            <div class="color-palette"></div>
            <h3 style="margin-top: 20px;">C√¥ng C·ª•</h3>
            <button id="complete-btn" class="back-button" style="margin-top: 10px; width: 100%; box-sizing: border-box; background-color: #2ecc71;">‚≠ê Ch·∫•m ƒêi·ªÉm!</button>
            <button id="save-btn" class="back-button" style="margin-top: 10px; width: 100%; box-sizing: border-box; background-color: #3498db; display: none;">L∆∞u v√†o Ph√≤ng Tr∆∞ng B√†y</button>
            <div id="scoring-area" style="text-align: center; margin-top: 10px;"></div>
        </div>
        <div class="canvas-container">
            <div class="canvas">
                <svg id="svg-house" class="active" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg"><g stroke="#000" stroke-width="5" fill="#FFF"><path class="colorable" d="M125,450 L125,250 L250,125 L375,250 L375,450 Z" /><path class="colorable" d="M100,250 L250,100 L400,250 Z" /><rect class="colorable" x="175" y="325" width="150" height="125" /><circle class="colorable" cx="280" cy="388" r="10"/></g></svg>
                <svg id="svg-flower" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g stroke="#000" stroke-width="1" fill="#FFF"><circle class="colorable" cx="50" cy="50" r="15"/><circle class="colorable" cx="50" cy="25" r="12"/><circle class="colorable" cx="75" cy="40" r="12"/><circle class="colorable" cx="75" cy="65" r="12"/><circle class="colorable" cx="50" cy="80" r="12"/><circle class="colorable" cx="25" cy="65" r="12"/><circle class="colorable" cx="25" cy="40" r="12"/></g></svg>
                <svg id="svg-car" viewBox="0 0 200 100" xmlns="http://www.w3.org/2000/svg"><g stroke="#000" stroke-width="2" fill="#FFF"><path class="colorable" d="M 20,70 A 20,20 0 0,0 20,30 L 60,30 L 80,10 L 150,10 L 170,30 L 180,50 L 180,70 Z" /><circle class="colorable" cx="50" cy="70" r="15"/><circle class="colorable" cx="150" cy="70" r="15"/></g></svg>
            </div>
            <div class="thumbnail-gallery">
                <div class="thumbnail selected" data-target="svg-house"><svg viewBox="0 0 500 500"><g stroke="#000" stroke-width="15" fill="#FFF"><path d="M125,450 L125,250 L250,125 L375,250 L375,450 Z" /><path d="M100,250 L250,100 L400,250 Z" /></g></svg></div>
                <div class="thumbnail" data-target="svg-flower"><svg viewBox="0 0 100 100"><g stroke="#000" stroke-width="3" fill="#FFF"><circle cx="50" cy="50" r="15"/><circle cx="50" cy="25" r="12"/><circle cx="75"cy="40" r="12"/><circle cx="75" cy="65" r="12"/><circle cx="50" cy="80" r="12"/><circle cx="25" cy="65" r="12"/><circle cx="25" cy="40" r="12"/></g></svg></div>
                <div class="thumbnail" data-target="svg-car"><svg viewBox="0 0 200 100"><g stroke="#000" stroke-width="5" fill="#FFF"><path d="M 20,70 A 20,20 0 0,0 20,30 L 60,30 L 80,10 L 150,10 L 170,30 L 180,50 L 180,70 Z" /><circle cx="50" cy="70" r="15"/><circle cx="150" cy="70" r="15"/></g></svg></div>
            </div>
        </div>
    </div>
    <a href="thanh-pho-sang-tao.html" class="back-button">V·ªÅ Th√†nh Ph·ªë S√°ng T·∫°o</a>

    <script>
        const colorPalette = document.querySelector('.color-palette');
        const thumbnails = document.querySelectorAll('.thumbnail');
        const completeButton = document.getElementById('complete-btn');
        const scoringArea = document.getElementById('scoring-area');
        const saveButton = document.getElementById('save-btn');
        let selectedColor = '#e74c3c';

        const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6', '#e67e22', '#1abc9c', '#ecf0f1', '#34495e'];
        colors.forEach(color => {
            const box = document.createElement('div');
            box.className = 'color-box';
            box.style.backgroundColor = color;
            if (color === '#ecf0f1') box.style.border = '1px solid #ddd';
            colorPalette.appendChild(box);
        });

        const colorBoxes = document.querySelectorAll('.color-box');
        
        function selectColor(box) {
             document.querySelector('.color-box.selected')?.classList.remove('selected');
             box.classList.add('selected');
             selectedColor = box.style.backgroundColor;
        }

        colorBoxes.forEach(box => box.addEventListener('click', () => selectColor(box)));
        
        function activateCanvas() {
            document.querySelectorAll('svg').forEach(svg => {
                svg.querySelectorAll('.colorable').forEach(part => {
                    part.addEventListener('click', () => { if(svg.classList.contains('active')) part.style.fill = selectedColor; });
                });
            });
        }
        
        thumbnails.forEach(thumb => {
            thumb.addEventListener('click', () => {
                document.querySelector('.thumbnail.selected')?.classList.remove('selected');
                document.querySelector('svg.active')?.classList.remove('active');
                
                thumb.classList.add('selected');
                const targetId = thumb.dataset.target;
                document.getElementById(targetId).classList.add('active');
                scoringArea.innerHTML = '';
                saveButton.style.display = 'none';
            });
        });

        completeButton.addEventListener('click', () => {
            const activeSvg = document.querySelector('svg.active');
            const allParts = activeSvg.querySelectorAll('.colorable');
            let coloredParts = 0;
            const usedColors = new Set();

            allParts.forEach(part => {
                const partColor = part.style.fill;
                if (partColor && partColor !== '' && partColor !== 'rgb(255, 255, 255)') {
                    coloredParts++;
                    usedColors.add(partColor);
                }
            });

            const totalParts = allParts.length;
            const completionScore = totalParts > 0 ? (coloredParts / totalParts) * 6 : 0;
            const varietyScore = (usedColors.size / (colors.length - 1)) * 4;
            const finalScore = Math.min(10, Math.round(completionScore + varietyScore));

            scoringArea.innerHTML = `<div class="score-display">ƒêi·ªÉm: ${finalScore} / 10</div>` + '‚≠ê'.repeat(Math.ceil(finalScore/2)) + '‚òÜ'.repeat(5 - Math.ceil(finalScore/2));
            saveButton.style.display = 'block';
        });

        saveButton.addEventListener('click', () => {
            const activeSvg = document.querySelector('svg.active');
            const svgData = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(activeSvg.outerHTML)));
            
            const savedArtworks = JSON.parse(localStorage.getItem('artworks')) || [];
            savedArtworks.unshift({ src: svgData, alt: 'T√°c ph·∫©m c·ªßa b√©' });
            if (savedArtworks.length > 6) savedArtworks.pop(); // Gi·ªõi h·∫°n 6 t√°c ph·∫©m
            localStorage.setItem('artworks', JSON.stringify(savedArtworks));
            
            const savedBadges = JSON.parse(localStorage.getItem('badges')) || [];
            if (!savedBadges.includes('üé®')) {
                savedBadges.push('üé®');
                localStorage.setItem('badges', JSON.stringify(savedBadges));
            }
            alert('ƒê√£ l∆∞u tranh v√†o Ph√≤ng Tr∆∞ng B√†y!');
            saveButton.style.display = 'none';
        });

        window.addEventListener('load', function() {
            const currentUserName = localStorage.getItem('currentUser');
            if (currentUserName) {
                document.getElementById('personalized-greeting').innerHTML = `Xin ch√†o b√© <span class="user-name">${currentUserName}</span>!`;
            }
            selectColor(colorBoxes[0]);
            activateCanvas();
        });
    </script>
</body>
</html>