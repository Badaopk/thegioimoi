<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HÃ nh Tinh MÆ¡ Æ¯á»›c</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="style.css">
    <style>
        .user-access {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .auth-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background-color: #ff6347;
            color: white;
            font-family: 'Baloo 2', cursive;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .auth-btn:hover {
            background-color: #e5533d;
        }
        .auth-btn.secondary {
            background-color: #1E90FF;
        }
         .auth-btn.secondary:hover {
            background-color: #1c80e3;
        }
        /* Style cho nÃºt Admin */
        .auth-btn.admin {
            background-color: #8e44ad;
        }
        .auth-btn.admin:hover {
            background-color: #732d91;
        }
        .user-greeting {
            font-weight: bold;
            font-size: 1.1rem;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="user-access" id="auth-container">
        </div>

    <h1 class="header-title">HÃ nh Tinh MÆ¡ Æ¯á»›c</h1>
    <p style="font-size: 1.5rem; color: #555;">HÃ£y chá»n má»™t nÆ¡i Ä‘á»ƒ khÃ¡m phÃ¡ nÃ o!</p>

    <div class="planet-container">
        <a href="thanh-pho-sang-tao.html" class="planet planet-creative">ğŸ¨<br>ThÃ nh Phá»‘ SÃ¡ng Táº¡o</a>
        <a href="thu-vien-tri-thuc.html" class="planet planet-knowledge">ğŸ“š<br>ThÆ° Viá»‡n Tri Thá»©c</a>
        
        <a href="nhiem-vu.html" class="planet" style="border-color: #e67e22;">ğŸ†<br>Nhiá»‡m Vá»¥ HÃ ng NgÃ y</a>
        
        <a href="dau-truong-thu-thach.html" class="planet planet-challenge">ğŸ¯<br>Äáº¥u TrÆ°á»ng Thá»­ ThÃ¡ch</a>
        <a href="choi-co.html" class="planet" style="border-color: #8e44ad;">ğŸ²<br>Äáº¥u TrÆ°á»ng Cá»</a>
        <a href="bai-kiem-tra.html" class="planet" style="border-color: #f39c12;">ğŸ“<br>BÃ i Kiá»ƒm Tra</a>
        <a href="ngoi-nha-cua-be.html" class="planet planet-home">ğŸ¡<br>NgÃ´i NhÃ  Cá»§a BÃ©</a>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    
    <script src="global-client.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const authContainer = document.getElementById('auth-container');
            
            try {
                const response = await fetch('/api/me');
                if (!response.ok) {
                    authContainer.innerHTML = `<a href="login.html"><button class="auth-btn">ÄÄƒng Nháº­p / ÄÄƒng KÃ½</button></a>`;
                    return;
                }

                const user = await response.json();
                
                // Cáº§n thiáº¿t Ä‘á»ƒ global-client.js biáº¿t user lÃ  ai
                localStorage.setItem('currentUser', user.username);
                let specialButton = '';

                // PhÃ¢n quyá»n nÃºt Ä‘áº·c biá»‡t
                if (user.role === 'parent') {
                    specialButton = `<a href="phu-huynh.html"><button class="auth-btn secondary">ğŸ‘¤ Báº£ng Phá»¥ Huynh</button></a>`;
                } else if (user.role === 'admin') {
                    specialButton = `<a href="admin-panel.html"><button class="auth-btn admin">âš™ï¸ Báº£ng Admin</button></a>`;
                }

                authContainer.innerHTML = `
                    <span class="user-greeting">ChÃ o, ${user.username}!</span>
                    ${specialButton}
                    <button id="logout-btn" class="auth-btn">ÄÄƒng Xuáº¥t</button>
                `;

                document.getElementById('logout-btn').addEventListener('click', async () => {
                    await fetch('/api/logout', { method: 'POST' });
                    // Cáº§n thiáº¿t Ä‘á»ƒ global-client.js ngá»«ng hoáº¡t Ä‘á»™ng
                    localStorage.removeItem('currentUser');
                    window.location.href = '/login.html';
                });

            } catch (error) {
                console.error('Lá»—i kiá»ƒm tra tráº¡ng thÃ¡i Ä‘Äƒng nháº­p:', error);
                authContainer.innerHTML = `<a href="login.html"><button class="auth-btn">ÄÄƒng Nháº­p / ÄÄƒng KÃ½</button></a>`;
            }
        });
    </script>
</body>
</html>